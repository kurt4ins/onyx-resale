{% extends 'base.html' %}
{% load static %}

{% block title %}Статистика - Onyx{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 class="dashboard-title">Статистика</h1>
</div>

<div class="seller-nav">
    <a href="{% url 'accounts:seller_dashboard' %}">Главная</a>
    <a href="{% url 'accounts:seller_products' %}">Товары</a>
    <a href="{% url 'accounts:seller_stats' %}" class="active">Статистика</a>
    <a href="{% url 'accounts:seller_references' %}">Справочники</a>
</div>

<div class="stats-grid" style="margin-bottom: 40px;">
    <div class="stat-card">
        <div class="stat-value">{{ total_products }}</div>
        <div class="stat-label">Всего товаров</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ active_products }}</div>
        <div class="stat-label">Активных товаров</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ sold_products }}</div>
        <div class="stat-label">Проданных товаров</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ avg_rating|default:"—" }}</div>
        <div class="stat-label">Средний рейтинг</div>
    </div>
</div>

{% if category_stats %}
    <div style="margin-bottom: 40px;">
        <h2 style="font-size: 24px; margin-bottom: 20px;">Товары по категориям</h2>
        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for stat in category_stats %}
                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f9f9f9; border-radius: 4px;">
                    <span>{{ stat.category__name|default:"Без категории" }}</span>
                    <strong>{{ stat.count }}</strong>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}

{% if brand_stats %}
    <div style="margin-bottom: 40px;">
        <h2 style="font-size: 24px; margin-bottom: 20px;">Товары по брендам</h2>
        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for stat in brand_stats %}
                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f9f9f9; border-radius: 4px;">
                    <span>{{ stat.brand__name|default:"Без бренда" }}</span>
                    <strong>{{ stat.count }}</strong>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}

{% if monthly_stats %}
    <div style="margin-bottom: 40px;">
        <h2 style="font-size: 24px; margin-bottom: 20px;">Товары по месяцам</h2>
        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for stat in monthly_stats %}
                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f9f9f9; border-radius: 4px;">
                    <span>{{ stat.month }}</span>
                    <strong>{{ stat.count }}</strong>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}

{% if rating_distribution %}
    <div>
        <h2 style="font-size: 24px; margin-bottom: 20px;">Распределение оценок</h2>
        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for dist in rating_distribution %}
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f9f9f9; border-radius: 4px;">
                    <span style="font-weight: 600;">{{ dist.rating }} ⭐</span>
                    <div style="flex: 1; height: 8px; background: #e5e5e5; border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; background: #000; width: {% widthratio dist.count total_reviews 100 %}%;"></div>
                    </div>
                    <span>{{ dist.count }}</span>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}
{% endblock %}

