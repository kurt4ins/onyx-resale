{% extends 'base.html' %}
{% load static %}

{% block title %}Заказ #{{ order.id }} - Onyx{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto; padding: 40px 20px;">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
        <div>
            <h1 style="font-size: 32px; margin-bottom: 8px;">Заказ #{{ order.id }}</h1>
            <p style="color: #666;">Создан: {{ order.created_at|date:"d.m.Y H:i" }}</p>
        </div>
        <div style="text-align: right;">
            <span style="display: inline-block; padding: 8px 16px; background: #f0f0f0; border-radius: 4px; font-size: 16px; font-weight: 500;">
                {{ order.get_status_display }}
            </span>
        </div>
    </div>

    <div style="display: grid; gap: 30px;">
        <!-- Товары в заказе -->
        <div>
            <h2 style="font-size: 24px; margin-bottom: 20px;">Товары в заказе</h2>
            <div style="display: grid; gap: 16px;">
                {% for item in order.items.all %}
                    <div style="display: flex; gap: 20px; padding: 20px; border: 1px solid #e5e5e5; border-radius: 8px; background: #ffffff;">
                        {% if item.product.images.first %}
                            <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product.title }}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 4px;">
                        {% else %}
                            <div style="width: 120px; height: 120px; background: #f5f5f5; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #999;">
                                Нет фото
                            </div>
                        {% endif %}
                        
                        <div style="flex: 1;">
                            <h3 style="font-size: 18px; margin-bottom: 8px;">
                                <a href="{% url 'catalog:product_detail' pk=item.product.id %}" style="color: #000; text-decoration: none;">
                                    {{ item.product.title }}
                                </a>
                            </h3>
                            {% if item.product.brand %}
                                <p style="color: #666; margin-bottom: 8px;">{{ item.product.brand.name }}</p>
                            {% endif %}
                            <p style="color: #666; margin-bottom: 12px;">Количество: {{ item.quantity }} шт.</p>
                            <p style="font-size: 18px; font-weight: 600;">{{ item.price|floatformat:0 }} ₽ × {{ item.quantity }} = {% widthratio item.price 1 item.quantity %} ₽</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Информация о заказе -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <!-- Платеж -->
            <div style="padding: 24px; background: #f9f9f9; border-radius: 8px;">
                <h3 style="font-size: 20px; margin-bottom: 16px;">Оплата</h3>
                {% if order.payments.exists %}
                    {% for payment in order.payments.all %}
                        <div style="margin-bottom: 12px;">
                            <p style="color: #666; font-size: 14px; margin-bottom: 4px;">Способ оплаты:</p>
                            <p style="font-weight: 500;">{{ payment.get_method_display }}</p>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <p style="color: #666; font-size: 14px; margin-bottom: 4px;">Статус:</p>
                            <p style="font-weight: 500;">{{ payment.get_status_display }}</p>
                        </div>
                        <div>
                            <p style="color: #666; font-size: 14px; margin-bottom: 4px;">Сумма:</p>
                            <p style="font-size: 20px; font-weight: 600;">{{ payment.amount|floatformat:0 }} ₽</p>
                        </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #666;">Информация о платеже отсутствует</p>
                {% endif %}
            </div>

            <!-- Итого -->
            <div style="padding: 24px; background: #f9f9f9; border-radius: 8px;">
                <h3 style="font-size: 20px; margin-bottom: 16px;">Итого</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 16px; border-top: 1px solid #e5e5e5;">
                    <p style="font-size: 18px;">Общая сумма:</p>
                    <p style="font-size: 28px; font-weight: 600;">{{ total_price|floatformat:0 }} ₽</p>
                </div>
            </div>
        </div>
    </div>

    <div style="margin-top: 30px;">
        <a href="{% url 'orders:order_list' %}" style="color: #000; text-decoration: underline;">← Вернуться к списку заказов</a>
    </div>
</div>
{% endblock %}

